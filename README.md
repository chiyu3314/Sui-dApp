### 二手車履歷 dApp

**專案名稱**：CarPassport
**核心價值**：基於 Sui 區塊鏈的不可篡改中古車履歷系統，結合 Web2 無感登入體驗。

---

#### 1. 角色與權限總覽

| 角色 | 登入方式 | 核心權限 |
| :--- | :--- | :--- |
| **一般用戶 (買家/車主)** | Google zkLogin / 錢包 | • 查看市場<br>• 鑄造車輛<br>• 管理車庫 (上架/下架/過戶)<br>• 查看詳細履歷 |
| **保養廠 (Service)** | Google zkLogin / 錢包 | • 所有一般用戶功能<br>• **專屬後台**：新增維修保養紀錄 (含專業數據) |
| **保險公司 (Insurance)** | Google zkLogin / 錢包 | • 所有一般用戶功能<br>• **專屬後台**：新增事故/理賠紀錄 |
| **管理員 (Admin)** | 錢包 (需持有 AdminCap) | • **管理後台**：授權/撤銷第三方機構資格 |

---

#### 2. 網站架構與頁面功能詳細描述

##### A. 公共區域 (無需登入即可訪問)

**1. 首頁 (Landing & Dashboard)**
*   **導航列 (Navbar)**：
    *   左側：Logo 與專案名稱。
    *   中間：頁籤導航（依據登入身分動態顯示：我的車庫、二手市場、合作夥伴、*保養後台*、*保險後台*、*管理後台*）。
    *   右側：登入/使用者狀態區。
        *   **未登入**：顯示「Google 登入」與「連接錢包」按鈕。
        *   **zkLogin**：顯示 "Google zkLogin" 及可複製的錢包地址 (0x...)。
        *   **Wallet**：顯示錢包地址。
*   **功能**：引導使用者進入不同專區。

**2. 二手車市場 (Marketplace)**
*   **展示邏輯**：顯示所有 `is_listed = true` 的車輛。
*   **呈現方式**：卡片式列表。
    *   **圖片**：車輛封面照 (Walrus)。
    *   **摘要**：品牌、型號、年份、里程數。
    *   **狀態**：顯示「出售中」。
*   **互動**：
    *   點擊卡片：進入 **「車輛履歷詳情頁」**。

**3. 合作夥伴清單 (Partner List) [NEW]**
*   **目的**：展示生態系中的認證機構，建立信任。
*   **內容**：列出所有擁有 (或曾經擁有) `ThirdPartyCap` 的機構。
*   **欄位**：
    *   機構名稱 (e.g., Toyota 台北廠)。
    *   類型 (保養廠 / 保險公司)。
    *   狀態 (✅ 認證中 / ❌ 已撤銷)。
    *   區塊鏈地址 (可點擊跳轉 Suiscan)。

---

##### B. 車主專區 (需登入)

**4. 鑄造車輛 (Mint Car)**
*   **表單**：
    *   VIN 碼 (提供隨機生成按鈕，Demo 用)。
    *   品牌、型號、年份、顏色。
    *   初始里程數。
    *   **車輛照片上傳** (上傳至 Walrus)。
*   **執行**：透過 Shinami 贊助交易 (zkLogin) 或錢包支付，將資料寫入鏈上並生成 Shared Object。

**5. 我的車庫 (My Garage)**
*   **展示邏輯**：顯示所有 `owner` 為當前使用者地址的車輛。
*   **呈現方式**：卡片式列表，但比市場多了操作按鈕。
*   **卡片功能**：
    *   **狀態標籤**：顯示目前是「私有」還是「公開出售」。
    *   **上下架開關 (Switch)**：
        *   切換為 `Listed`：車子會出現在二手車市場。
        *   切換為 `Private`：從市場移除。
    *   **過戶按鈕 (Transfer)**：
        *   點擊彈出視窗 -> 輸入接收者地址 -> 確認過戶。
        *   (註：過戶後車子會自動下架並從你的車庫消失)。
    *   **查看詳情**：點擊進入詳情頁。

---

##### C. 履歷詳情頁 (Core Feature)

**6. 車輛履歷詳情頁 (/car/[id])**
這是所有人都看得到的頁面（公開透明）。
*   **車輛資訊區**：大圖、基本資料 (VIN, 年份等)、當前車主。
*   **履歷時間軸 (Timeline)**：
    *   按時間倒序列出所有 `Record`。
    *   每筆紀錄包含：
        *   **日期**。
        *   **類型**：保養 (藍色) / 事故 (紅色)。
        *   **執行機構**：(e.g., 國泰產險)。
        *   **里程數**：當時的里程。
        *   **描述**：維修/理賠內容。
        *   **附件區**：顯示上傳的照片或文件連結 (Walrus)。
        *   **專業數據 (如果有)**：點擊展開查看 DTC 故障碼、更換零件細項等。

---

##### D. 合作夥伴後台 (需特定權限)

**7. 保養廠作業系統 (Workshop OS)**
*   **權限**：僅限持有 `ThirdPartyCap (Type=1)` 的地址進入。
*   **功能**：新增保養紀錄。
*   **輸入**：
    *   目標車輛 ID。
    *   最新里程數。
    *   維修說明。
    *   **專業數據**：是否重置電腦、故障碼 (Tags)、下次保養建議。
    *   **多檔上傳**：維修單、車況照片 (Walrus)。

**8. 保險公司作業系統 (Insurance OS)**
*   **權限**：僅限持有 `ThirdPartyCap (Type=2)` 的地址進入。
*   **功能**：新增事故/理賠紀錄。
*   **輸入**：
    *   目標車輛 ID。
    *   出險時里程。
    *   事故說明。
    *   **佐證資料**：事故現場照片、理賠書 (Walrus)。

---

##### E. 管理員後台 (需 AdminCap)

**9. 權限管理系統**
*   **發放權限 (Grant)**：
    *   輸入對方地址、機構名稱、選擇類型 (保養/保險)。
    *   執行後發送 NFT 給對方。
*   **撤銷權限 (Revoke)**：
    *   輸入 Cap ID，將其在鏈上註冊表標記為無效。
